#!/usr/bin/python3

import rospy
import serial
from nmea_msgs.msg import Sentence


import time
import datetime
from base64 import b64encode



#line = b'\xd3\x00\x16E\xd0\x00xU-\x0e?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x82\xa6\xf9\xd3\x00\x16Fp\x00xTRN?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00V$ \xd3\x00\x08? \x00\x9f@\x8ep\x00\xb3\x7f\xbf\xd3\x00\x08>\xa0\x00xU-\x0c\x00\x91\xac\xa6\xd3\x00\x16E\xd0\x00xU<\xae?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd7\xd6\xef\xd3\x00\x12>\xa0\x00xU<\xac\x100\x1b!\x87\x00\x00\x14\xd4\r\x00\xd1\xd0\x1a\xd3\x00\x16E0\x00xm\x97\x0e?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00$\xab\xb1\xd3\x00\x16E\xd0\x00xm\x97\x0e?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb4\x9ea\xd3\x00\x16Fp\x00xl\xbcN?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00d\xb3\xa9\xd3\x00\x08? \x00\xa0\x03\xdep\x00\xad\x0c\x8a\xd3\x00\x08>\xa0\x00xm\x97\x0c\x006$2\xd3\x00\x16E\xd0\x00xm\xa6\xae?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\x08g\xd3\x00\x08>\xa0\x00xm\xa6\xac\x00\xe1i\x8b\xd3\x00\x16D\x90\x00xm\xb6N?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-D\x92\xd3\x00\x16E0\x00xm\xb6N?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x81e\xfc\xd3\x00\x16E\xd0\x00xm\xb6N?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11P,\xd3\x00\x16Fp\x00xl\xdb\x8e?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12\xf1G\xd3\x00\x08? \x00\xa0\x04\xd8p\x00)\x9f0\xd3\x00\x08>\xa0\x00xm\xb6L\x00P\x08\xc7\xd3\x00\x16E\xd0\x00xm\xc5\xee?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xdah\x90\xd3\x00\x08>\xa0\x00xm\xc5\xec\x00\xc9\xbe\x02\xd3\x00\x16D\x90\x00xm\xd5\x8e?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00EZ\xbe\xd3\x00\x16E0\x00xm\xd5\x8e?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe9{\xd0\xd3\x00\x16E\xd0\x00xm\xd5\x8e?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00yN\x00\xd3\x00\x16Fp\x00xl\xfa\xce?\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb7?\n'
#d = line.decode('ISO-8859-1')
#print(d)      

rospy.init_node("nmea_publisher")
pub = rospy.Publisher("nmea_sentence", Sentence, queue_size=1)


def do_read():
    ser = serial.Serial('/dev/ttyACM0')
      
    msg = ser.readline()
   #print(msg.decode('ascii'))
    sentence = Sentence()
    sentence.header.frame_id = 'gps'
    sentence.header.stamp = rospy.Time.now()
    sentence.sentence = msg.decode('utf-8')
    pub.publish(sentence)
  


def main():

    try:

        while not rospy.is_shutdown():
            do_read()

    except rospy.ROSInterruptException:

        pass




if __name__ == "__main__":

    main()